(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{372:function(t,e,r){"use strict";r.r(e);var v=r(14),_=Object(v.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"til-20210421"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#til-20210421"}},[t._v("#")]),t._v(" TIL-20210421")]),t._v(" "),e("h1",{attrs:{id:"today"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#today"}},[t._v("#")]),t._v(" Today")]),t._v(" "),e("ul",[e("li",[t._v("aws S3 https deploy")])]),t._v(" "),e("h1",{attrs:{id:"content"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#content"}},[t._v("#")]),t._v(" Content")]),t._v(" "),e("p",[t._v("S3를 통해 정적 페이지를 배포하는것이 가능하다. (이전 포스트에서 다루었다. "),e("RouterLink",{attrs:{to:"/TIL/TIL-20210420.html"}},[t._v("어제 TIL")]),t._v(" )"),e("br"),t._v("\n기본적으로 S3를 통한 배포는 http만 지원 한다.")],1),t._v(" "),e("p",[e("strong",[t._v("S3에서 https 배포")]),t._v("\nS3만을 이용해서 https를 배포하는 것은 불가능하다."),e("br"),t._v("\n아마존에서 제공하는 서비스 중 몇 가지를 추가해 https를 적용하기로 했다.")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("cloudfront\nhttp요청을 https요청으로 redrection 해줄 수 있는 서비스 이다."),e("br"),t._v("\nCDN(Content Delivery Network)의 일종이다.")])]),t._v(" "),e("li",[e("p",[t._v("Route 53\n나의 서비스를 DNS서버의 엔드포인트와 연결해주는 서비스 이다."),e("br"),t._v("\n외부 도메인을 구입해 해당 도메인에 접속 시 내가 배포하는 서비스에 접속 할 수 있게 해준다.")])]),t._v(" "),e("li",[e("p",[t._v("certificate Manager\n인증서 관리 서비스 이다."),e("br"),t._v("\n특정 도메인에 대한 인증서를 발급해 해당 도메인을 사용할 시 필요한 인증서를 관리해주는 서비스 이다.")])])]),t._v(" "),e("p",[e("strong",[t._v("배포 과정")]),t._v("\ncloudfront를 통해 https 통신을 지원해야 하기 때문에,"),e("br"),t._v("\n새로운 distribution을 설정해야 한다.")]),t._v(" "),e("p",[t._v("origin을 배포할 s3로 설정한다. (REST API endpoint로 설정 된다.)"),e("br"),t._v("\nhttp redirect to https로 설정한다."),e("br"),t._v("\ndefault object를 index.html (s3 버킷 메인 페이지랑 같은 파일)로 설정한다.")]),t._v(" "),e("p",[t._v("미리 외부 도메인 (route 53을 통해 구매하지 않은 도메인)을 인증 받았다면,"),e("br"),t._v("\nalternate domain names에 추가한다. (exampel.com)")]),t._v(" "),e("p",[t._v("인증 받지 못했다면 일단 생성하고 다음으로 넘어간다.")]),t._v(" "),e("p",[e("strong",[t._v("client에서 react-router-dom을 사용하는 경우")]),t._v("\n이 경우에는 메인 페이지에서 react-router-dom을 통해 redirect가 일어나기 때문에, 403에러가 발생할 수 있다."),e("br"),t._v("\n때문에, 생성한 "),e("code",[t._v("cloudfront distribution")]),t._v("에서 "),e("code",[t._v("error page")]),t._v("에 대한 핸들링이 필요하다.")]),t._v(" "),e("p",[t._v("403, 404에러를 index.html 경로로 redirect 세팅을 해주고 200 response state로 변경한다.")]),t._v(" "),e("p",[e("strong",[t._v("외부 도메인 인증")]),t._v("\nroute 53을 통해 일단 도메인의 nameserver를 생성해 외부 도메인 제공업체에 등록을 해야한다.\nroute 53에서 새로운 호스팅을 생성하고, 내가 만든 도메인을 등록한다.")]),t._v(" "),e("p",[t._v("등록한 이후에는 "),e("code",[t._v("NS")]),t._v(", "),e("code",[t._v("SOA")]),t._v(" 두 가지 유형의 레코드가 생성된다."),e("br"),t._v(" "),e("code",[t._v("NS")]),t._v("에 등록된 트래픽 대상을 내가 도메인을 구매한 곳에서 Nameserver로 등록해준다.")]),t._v(" "),e("p",[t._v("이제 certificate manager를 통해서 인증서를 발급한다.\n내가 구매한 도메인(example.com) + 서브도메인을 포함한 도메인 (www.example.com)을 인증서에 등록하고 DNS를 통한 인증일 진행한다.")]),t._v(" "),e("p",[t._v("이 단계에서 꽤 오랜 시간이 소요된다. (인증까지)")]),t._v(" "),e("p",[e("strong",[t._v("https 설정을 위한 엔드포인트 설정")]),t._v("\n이전에 생성했던 cloudfront distribute를 수정하기 위해 "),e("code",[t._v("edit")]),t._v("을 통해\nCNAMEs에 인증서를 생성한 도메인 두 가지 (example.com, wwww.example.com)을 등록하고\n그리고 해당 도메인을 통해 받은 SSL인증서를 등록한다.\n등록이 완료되면 다시 route 53으로 돌아가 새로운 레코드를 생성하면 설정이 완료된다.")]),t._v(" "),e("p",[t._v("route 53에서 새로운 레코드는 두 가지를 생성해준다.\n서브도메인을 사용한 주소와 내가 사용한 도메인 주소 두 가지를 모두 route를 등록한다.")]),t._v(" "),e("p",[t._v("레코드명을 도메인으로 등록하고 라우팅 대상을 "),e("code",[t._v("별칭")]),t._v(" 옵션을 활성화 해 "),e("code",[t._v("cloudfront")]),t._v(" 별칭을 찾아서 등록하면 된다.")])])}),[],!1,null,null,null);e.default=_.exports}}]);