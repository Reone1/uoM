(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{353:function(t,s,a){"use strict";a.r(s);var n=a(14),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"til-20210322"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#til-20210322"}},[t._v("#")]),t._v(" TIL-20210322")]),t._v(" "),s("h1",{attrs:{id:"github-actions를-이용해-자동으로-pages-업데이트-하기"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#github-actions를-이용해-자동으로-pages-업데이트-하기"}},[t._v("#")]),t._v(" Github actions를 이용해 자동으로 pages 업데이트 하기")]),t._v(" "),s("h2",{attrs:{id:"기존-처리-방식"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#기존-처리-방식"}},[t._v("#")]),t._v(" 기존 처리 방식")]),t._v(" "),s("ol",[s("li",[t._v("로컬에서 빌드한다.")]),t._v(" "),s("li",[t._v("새로 빌드한 디렉토리"),s("code",[t._v("dist")]),t._v("에서 새로운 "),s("code",[t._v("git init")]),t._v("을 실행한다.")]),t._v(" "),s("li",[t._v("새로 만든 "),s("code",[t._v("gitbase")]),t._v("에서 원격 저장소를 연결한다.")]),t._v(" "),s("li",[s("code",[t._v("gh-pages")]),t._v("에 강제로 푸시한다.")])]),t._v(" "),s("p",[t._v("위 과정은 언제나 똑같다. 어떤 글을 써도 똑같이 진행한다. 이 과정을 한번에 진행할 수 있는 방법을 찾는 중에 vuepress 공식 페이지에서 추천하는 방법들이 있다.")]),t._v(" "),s("h2",{attrs:{id:"자동화-방법"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#자동화-방법"}},[t._v("#")]),t._v(" 자동화 방법")]),t._v(" "),s("p",[t._v("추천하는 방식은 세 가지 이다.")]),t._v(" "),s("ol",[s("li",[t._v("매번 쉘 스크립트를 실행한 후 push하는 것")]),t._v(" "),s("li",[t._v("gitlab을 이용하는 것")]),t._v(" "),s("li",[t._v("Travis CI를 이용하는 것")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("매번 쉘 스크립트를 실행한 후 push하는 것 ❌"),s("br"),t._v("\n로컬에 빌드하는게 맘에 들지 않았다. 로컬에서는 라이브 서버도 열지 않고 테스트하고 싶은 맘이다.")])]),t._v(" "),s("li",[s("p",[t._v("Travis를 이용하는 것 ❌"),s("br"),t._v("\n지금 vuepress도 처음 쓰는데 Travis까지 한번에 이해하려고 하는건 너무 과하지 않을까라 생각 했다.")])]),t._v(" "),s("li",[s("p",[t._v("gitlab(OR actions)를 이용하는 것 👍  내가 고른것"),s("br"),t._v("\n깃은 평소에도 자주 사용하니까 뭔가 쉽게 눈에 들어오지 않을까란 안일한 판단으로 이게 제일 맘에 들었다.")])])]),t._v(" "),s("h2",{attrs:{id:"첫-단추"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#첫-단추"}},[t._v("#")]),t._v(" 첫 단추")]),t._v(" "),s("p",[t._v("나는 Github actions을 이용하기로 했다."),s("br"),t._v("\nyaml을 통해서 github actions을 정의 할 수 있다."),s("br"),t._v("\nyaml 데이터를 통해서 정해진 스크립트가 실행된다.")]),t._v(" "),s("p",[t._v("스크립트가 작동되는 트리거 부터 환경 및 순서 까지 내가 다 정할 수 있었다."),s("br"),t._v("\n처음에 접근한 방식은 최대한 "),s("strong",[t._v("사용자 정보 없이 데이터를 업데이트 할 수 있는가")]),t._v(" 였다.")]),t._v(" "),s("p",[t._v("기본적으로 내가 하던 방식을 스크립트로 구현하기로 했다.")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 일단 가상 컴퓨터에서 다시 내 레포를 initialize하고 vuepress를 빌드한다.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" npm init & vuepress build\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n    npm install\n    npm run build")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# github settings git 관련 기본 세팅을 설정한다.")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" git settings actions env\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v('\n      git config --global user.name "Re1one" \n      git config --global user.email j901207@gmail.com\n      git config --global init.defaultBranch master')]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 빌드된 파일에서 새 레포를 생성해 pages로 반영한다.")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" create new commit and deploy gh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pages\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v('\n      cd docs/.vuepress/dist\n      git init\n      git remote add origin https://github.com/Reone1/uoM.git\n      git add .\n      git commit -m "deploy"\n      git push -f origin master:gh-pages')]),t._v("\n")])])]),s("h3",{attrs:{id:"문제-상황"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#문제-상황"}},[t._v("#")]),t._v(" 문제 상황")]),t._v(" "),s("p",[t._v("사용자 정보를 입력했으나, 레포의 주인인지는 정확히 알 수 없는 상태로 남아있었다."),s("br"),t._v("\n때문에 해당 레포에 대한 접근이 불가능 했고 origin으로의 푸시가 불가능 했다.")]),t._v(" "),s("h2",{attrs:{id:"해결-방법"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#해결-방법"}},[t._v("#")]),t._v(" 해결 방법")]),t._v(" "),s("p",[s("strong",[t._v("토근을 심는다.")])]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 기존 방식")]),t._v("\ngit remote add origin https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//github.com/Reone1/uoM.git\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 변경된 스크립트")]),t._v("\ngit remote add origin https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//Reone1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("secrets.TOKEN"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("@github.com/Reone1/uoM.git\n")])])]),s("p",[t._v("토큰을 만드는 방법은 다른 포스팅으로 소개 해야 할 것 같다."),s("br"),t._v("\n간단하게는 내 계정 설정에서 "),s("code",[t._v("Developer settings")]),t._v("에서 생성해서,"),s("br"),t._v("\n해당 레포에 "),s("code",[t._v("secrets")]),t._v("에 등록해서 사용한다.")]),t._v(" "),s("p",[s("code",[t._v("secrets")]),t._v("에 등록한 이름을 통해 actions에서 "),s("code",[t._v("secrets")]),t._v("의 "),s("code",[t._v("props")]),t._v("처럼 접근이 가능하다.")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("secrets.TOKEN"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 내가 secrets에 설정한 TOKEN이라는 이름의 인증토큰")]),t._v("\n")])])]),s("h2",{attrs:{id:"결론"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#결론"}},[t._v("#")]),t._v(" 결론")]),t._v(" "),s("p",[t._v("처음에는 뭔가 actions 실행 과정에서 스크립트 실행 순서가 문제가 있는 것으로 생각했다."),s("br"),t._v("\n일단 세팅 먼저 하고 다음을 진행안하면 문제가 생긴다.")]),t._v(" "),s("p",[t._v("중간에는 커밋도 하지 않고 푸시하려고 해서 문제가 생겼고"),s("br"),t._v("\n커밋 이후에는 해당 레포지토리가 없다는 말이 나와서,"),s("br"),t._v("\norigin이 정상적으로 설정되지 않는 것으로 오해했다.")]),t._v(" "),s("p",[t._v("토큰이 없어서 origin에 접근이 불가능했다는 걸 알고,"),s("br"),t._v("\n결국 토큰을 넣을 수 밖에 없었다."),s("br"),t._v("\n자연스럽게 인증이 되는 방법은 없는 것 같다."),s("br"),t._v("\n가만히 생각해보면 아무나 내 레포에 푸시한다는 말인데 말이 안된다...")]),t._v(" "),s("p",[t._v("중간에 진행하면서 알게 된 사실")]),t._v(" "),s("ul",[s("li",[t._v("remote add는 https 요청을 보낸다")]),t._v(" "),s("li",[t._v("remote set-url은 ssh 요청을 보낸다.")])]),t._v(" "),s("p",[t._v("두 가지 명령어는 모두 오리진 세팅을 하지만,"),s("br"),t._v("\n프로토콜이 다르다.")]),t._v(" "),s("p",[t._v("사용자 인증 방식이 다른건데 설정을 안하면 큰 차이는 없다.\n이후에 오는 주소값이 조금 다르다.")])])}),[],!1,null,null,null);s.default=e.exports}}]);