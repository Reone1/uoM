(window.webpackJsonp=window.webpackJsonp||[]).push([[97],{393:function(r,t,e){"use strict";e.r(t);var s=e(14),o=Object(s.a)({},(function(){var r=this,t=r._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":r.$parent.slotKey}},[t("h1",{attrs:{id:"til-20210914"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#til-20210914"}},[r._v("#")]),r._v(" TIL-20210914")]),r._v(" "),t("h1",{attrs:{id:"today"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#today"}},[r._v("#")]),r._v(" Today")]),r._v(" "),t("ul",[t("li",[r._v("RabbitMQ Issue handle")])]),r._v(" "),t("h1",{attrs:{id:"content"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#content"}},[r._v("#")]),r._v(" Content")]),r._v(" "),t("blockquote",[t("p",[r._v("문제상황\nMQ HTML Client 상에서 Virtual host (Vhost)를 "),t("code",[r._v("/")]),r._v(" 생성해도 NestJS MS가 인식하지 못하는 현상")])]),r._v(" "),t("h2",{attrs:{id:"error-massge-html-client"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#error-massge-html-client"}},[r._v("#")]),r._v(" Error massge (HTML Client)")]),r._v(" "),t("p",[t("code",[r._v("Virtual host / experienced an error on node rabbit@localhost and may be inaccessible")]),r._v("\n해당 Vhost를 생성하고 Admin user를 설정하더라도 Vhost Restart를 하지 못해서 접근이 불가능한 상황")]),r._v(" "),t("h3",{attrs:{id:"error-log"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#error-log"}},[r._v("#")]),r._v(" Error log")]),r._v(" "),t("div",{staticClass:"language-zsh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[r._v('2021-09-13 18:06:13.086926+09:00 [erro] <0.4063.0> Unable to recover vhost <<"/">> data. Reason {error,\n2021-09-13 18:06:13.086926+09:00 [erro] <0.4063.0>                                               {{{badmatch,\n2021-09-13 18:06:13.086926+09:00 [erro] <0.4063.0>                                                  {error,\n2021-09-13 18:06:13.086926+09:00 [erro] <0.4063.0>                                                   {"/usr/local/var/lib/rabbitmq/mnesia/rabbit@localhost/msg_stores/vhosts/628WB79CIFDYO9LJI6DKMI09L/msg_store_transient/file_summary.ets",\n2021-09-13 18:06:13.086926+09:00 [erro] <0.4063.0>                                                    eacces}}},\n2021-09-13 18:06:13.086926+09:00 [erro] <0.4063.0>                                                 [{rabbit_msg_store,init,1,\n2021-09-13 18:06:13.086926+09:00 [erro] <0.4063.0>                                                   [{file,\n2021-09-13 18:06:13.086926+09:00 [erro] <0.4063.0>                                                     "src/rabbit_msg_store.erl"},\n2021-09-13 18:06:13.086926+09:00 [erro] <0.4063.0>                                                    {line,724}]},\n2021-09-13 18:06:13.086926+09:00 [erro] <0.4063.0>                                                  {gen_server2,init_it,6,\n2021-09-13 18:06:13.086926+09:00 [erro] <0.4063.0>                                                   [{file,\n2021-09-13 18:06:13.086926+09:00 [erro] <0.4063.0>                                                     "src/gen_server2.erl"},\n2021-09-13 18:06:13.086926+09:00 [erro] <0.4063.0>                                                    {line,565}]},\n2021-09-13 18:06:13.086926+09:00 [erro] <0.4063.0>                                                  {proc_lib,init_p_do_apply,3,\n2021-09-13 18:06:13.086926+09:00 [erro] <0.4063.0>                                                   [{file,"proc_lib.erl"},\n2021-09-13 18:06:13.086926+09:00 [erro] <0.4063.0>                                                    {line,226}]}]},\n2021-09-13 18:06:13.086926+09:00 [erro] <0.4063.0>                                                {child,undefined,\n2021-09-13 18:06:13.086926+09:00 [erro] <0.4063.0>                                                 msg_store_transient,\n2021-09-13 18:06:13.086926+09:00 [erro] <0.4063.0>                                                 {rabbit_msg_store,start_link,\n2021-09-13 18:06:13.086926+09:00 [erro] <0.4063.0>                                                  [msg_store_transient,\n2021-09-13 18:06:13.086926+09:00 [erro] <0.4063.0>                                                   "/usr/local/var/lib/rabbitmq/mnesia/rabbit@localhost/msg_stores/vhosts/628WB79CIFDYO9LJI6DKMI09L",\n2021-09-13 18:06:13.086926+09:00 [erro] <0.4063.0>                                                   undefined,\n2021-09-13 18:06:13.086926+09:00 [erro] <0.4063.0>                                                   {#Fun<rabbit_variable_queue.0.124157698>,\n2021-09-13 18:06:13.086926+09:00 [erro] <0.4063.0>                                                    ok}]},\n2021-09-13 18:06:13.086926+09:00 [erro] <0.4063.0>                                                 transient,600000,worker,\n2021-09-13 18:06:13.086926+09:00 [erro] <0.4063.0>                                                 [rabbit_msg_store]}}}\n')])])]),t("h2",{attrs:{id:"solution"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#solution"}},[r._v("#")]),r._v(" solution")]),r._v(" "),t("p",[r._v("var/rabbitmq에 접근해 해당 키 값 (지금 상황에서는 628WB79CIFDYO9LJI6DKMI09L)을 가진 Directory를 삭제하고 다시 Vhost를 생성하면 정상적으로 Vhost가 작동함")]),r._v(" "),t("h2",{attrs:{id:"conclution"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#conclution"}},[r._v("#")]),r._v(" Conclution")]),r._v(" "),t("p",[r._v("Vhost 관련 설정등이 해당 Directory에 남으면서 "),t("code",[r._v("/")]),r._v("경로에 따라 생성되는 Directory가 정상적으로 생성되지 않아서 생기는 문제인 듯 하다.")])])}),[],!1,null,null,null);t.default=o.exports}}]);